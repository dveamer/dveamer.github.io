
<div id="associated_div">

  <br/>
  <div class="subtitle-header">
    <h3 class="subtitle">
      Associated Posts
    </h3>
    <small>I have gathered articles with the same tag so that you can explore related topics. Please tap the title.</small><br>
  </div>

  <div class="associated_posts">
    <ul class="post-list">
      {% assign tag_count = 0 %}

      {% for post in site.posts %}  
        {% assign exist = false %}

        {% if post.title == page.title %}
          {% assign exist = true %}
        {% endif %}

        {% for post_tag in post.tags %}

          {% if post.tags[0] == post_tag %}
            {% continue %}
          {% endif %}

          {% for page_tag in page.tags %}

            {% if page.tags[0] == page_tag %}
              {% continue %}
            {% endif %}

            {% if exist == true %}
              {% break %}
            {% endif %}
            {% if page_tag == post_tag %}
              <li>
                <br/>
                <h3>
                  <a href="{{ post.url }}">{{ post.title }}</a>
                </h3>

                <span class="post-meta">{{ post.date | date: "%b %-d, %Y" }}</span>
                <span class="post-meta">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                <span class="post-meta disqus-comment-count" 
                  {% if post.identifier.size > 0 %} data-disqus-identifier="{{ post.identifier }}" {% endif %}
                  data-disqus-url="{{ site.disqus_domain }}{{ post.url | prepend: site.baseurl }}">0 Comments</span>

                {% if post.categories.size > 0 %}
                  <span class="post-meta">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                  {% for category in post.categories %}

                    {% if forloop.index < 4 %}
                      <span class="post-meta">{{ category | capitalize }}</span>
                    {% elsif forloop.index == 4 %}
                      <span class="post-meta">...</span>
                    {% endif %}
                  {% endfor %}
                {% endif %}

                {% if post.tags.size > 0 %}
                  <span class="post-meta">&nbsp;&nbsp;|&nbsp;&nbsp;</span>
                  {% for tag in post.tags %}
                    {% if forloop.index < 4 %}
                      <span class="post-meta">{{ tag }}</span>
                    {% elsif forloop.index == 4 %}
                      <span class="post-meta">...</span>
                    {% endif %}
                  {% endfor %}
                {% endif %}

                <hr id="line">

              {% if tag_count <= 2 %} 
                <div class="content">
                {{ post.excerpt }}
                </div>
                <div>
                ... <a href="{{ post.url }}">more</a>
                </div>

              {% endif %}

              </li>

              {% assign exist = true %}
              {% assign tag_count = tag_count | plus: 1 %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endfor %}


      {% if tag_count == 0 %}
        <script>
          $("#associated_div").hide();
        </script>
      {% endif %}

    </ul>
  </div>
  <br/>

</div>
